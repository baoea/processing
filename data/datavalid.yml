files:
  fuse/personnel.csv:
    schema: personnel
  fuse/complaint.csv:
    schema: complaint
  fuse/event.csv:
    schema: event
  fuse/use_of_force.csv:
    schema: use_of_force

schemas:
  personnel:
    columns:
      - name: uid
        description: >
          unique identifier for officer
        unique: true
        no_na: true
      - name: last_name
        description: >
          person last name plus suffix if any
        title_case: true
      - name: middle_name
        description: >
          person middle name
        title_case: true
      - name: middle_initial
        description: >
          initial letter of middle name
        title_case: true
      - name: first_name
        description: >
          person first name
        title_case: true
      - name: birth_year
        integer: true
      - name: birth_month
        integer: true
      - name: birth_day
        integer: true
      - name: race
        options:
          - black
          - white
          - hispanic
          - native american
          - asian / pacific islander
          - mixed
      - name: sex
        options:
          - female
          - male
    validation_tasks:
      - name: birth dates should be valid
        valid_date:
          date_from:
            year_column: birth_year
            month_column: birth_month
            day_column: birth_day
          min_date: "1900-01-01"
  complaint:
    columns:
      - name: uid
        description: >
          accused officer's unique identifier. This references the `uid` column in personnel.csv
      - name: tracking_number
        description: >
          complaint tracking number from the agency the data originate from
      - name: complaint_uid
        description: >
          complaint unique identifier
        unique: true
        no_na: true
      - name: charge_uid
      - name: investigation_status
      - name: assigned_unit
      - name: assigned_department
      - name: assigned_division
      - name: assigned_sub_division_a
      - name: assigned_sub_division_b
      - name: traffic_stop
      - name: body_worn_camera_available
      - name: app_used
      - name: citizen_arrested
      - name: allegation_finding
        description: >
          finding of an individual allegation
        options:
          - sustained
          - exonerated
          - illegitimate outcome
          - counseling
          - mediation
          - not sustained
          - unfounded
          - no investigation merited
          - pending
      - name: allegation
        description: >
          the same data that can be found in `paragraph_code` and `paragraph_violation`.
          In fact this column should be merged with the paragraph_ columns.
      - name: allegation_class
        description: >
          the same data that can be found in `rule_code` and `rule_violation`. This should
          eventually be merged with the code_ columns.
      - name: citizen
        description: >
          demographic info of the involved citizen
      - name: disposition
        description: >
          the final disposition for the complaint
      - name: rule_code
        description: >
          a charge is usually consist of a rule and paragraph that was violated. This is
          the code of the violated rule.
      - name: rule_violation
        description: >
          a charge is usually consist of a rule and paragraph that was violated. This is
          the text of the violated rule.
      - name: paragraph_code
        description: >
          a charge is usually consist of a rule and paragraph that was violated. This is
          the paragraph number.
      - name: paragraph_violation
        description: >
          a charge is usually consist of a rule and paragraph that was violated. This is
          the text of the violated paragraph.
      - name: charges
        description: >
          `rule_*` and `paragraph_*` columns combined. Inputs that are too hard to parse and
          split into rule and paragraph will end up here.
      - name: officer_years_of_service
      - name: complainant_name
        description: >
          redacted if the complainant isn't a police officer.
      - name: complainant_type
        description: >
          whether the complaint originate from within the agency or from outside
      - name: complainant_sex
        options:
          - female
          - male
      - name: complainant_race
        options:
          - black
          - white
          - hispanic
          - native american
          - asian / pacific islander
          - mixed
      - name: complainant_age
      - name: action
        description: >
          what (disciplinary) actions were taken regarding this complaint
      # - name: data_production_year
      #   description: >
      #     the year of the original data. Usually it is the year number appear
      #     in the original data file. Perhaps we don't need this column anymore (now
      #     that there is the event tables).
      #   integer: true
      #   range: [1900, 2021]
      - name: agency
        description: >
          the police department the accused belong to.
      - name: incident_type
        description: >
          This field comes from IPM and seems to contains the same kind of info as
          `complainant_type`. However it contains conflicting info in some places,
          we should investigate more.
      - name: supervisor_uid
        description: >
          supervisor is usually the investigating supervisor. If the supervisor could
          be matched against one of the officers in the same department then this
          references the row with the same `uid` in personnel table.
      - name: supervisor_rank
      - name: supervisor_name
      - name: badge_no
        description: accused's badge number during incident
      - name: department_code
        description: >
          internal code of the department the accused belonged to during the incident.
          Due to how widely unavailable this field is, it is not very useful.
      - name: department_desc
        description: >
          text description of the department the accused belonged to during the incident.
      - name: rank_code
      - name: rank_desc
        description: >
          text description of the accused's rank during the incident.
      - name: employment_status
        description: >
          whether the accused was fulltime or reserve during incident.
      - name: investigator
      - name: investigator_uid
      - name: investigator_rank
      - name: shift_supervisor
      - name: complaint_classificaiton
    validation_tasks:
      - name: if `allegation_finding` is "sustained" then `disposition` should also be "sustained"
        warn_only: true
        empty:
          and:
            - column: allegation_finding
              op: equal
              value: sustained
            - column: disposition
              op: not_equal
              value: sustained
  event:
    columns:
      - name: event_uid
        description: >
          unique identifier for each event
        unique: true
        no_na: true
      - name: kind
        options:
          - officer_level_1_cert
          - officer_pc_12_qualification
          - officer_rank
          - officer_dept
          - officer_hire
          - officer_left
          - officer_pay_prog_start
          - officer_pay_effective
          - officer_post_decertification
          - complaint_incident
          - complaint_receive
          - allegation_create
          - charges_create
          - investigation_start
          - investigation_complete
          - suspension_start
          - suspension_end
          - appeal_file
          - appeal_hearing
          - appeal_hearing_2
          - appeal_receive
          - appeal_render
          - appeal_disposition
          - uof_incident
          - uof_receive
          - uof_assigned
          - uof_completed
          - uof_created
          - uof_due
          - award_receive
          - award_recommended
        no_na: true
      - name: year
        integer: true
        no_na: true
      - name: month
        integer: true
      - name: day
        integer: true
      - name: time
        match_regex: ^\d{2}:\d{2}$
      - name: raw_date
        description: >
          raw date string from which `year`, `month`, `day` and `time` was extracted.
      - name: uid
        description: >
          officer unique identifer, references the `uid` column in personnel.csv
      - name: complaint_uid
        description: >
          complaint unique identifier, refernces the `complaint_uid` column in complaint.csv
      - name: appeal_uid
        description: >
          appeal hearing unique identifier, references the `appeal_uid` column in
          app_*.csv files.
      - name: resolution_uid
      - name: uof_uid
        description: >
          unique identifier for a use of force report, references the `uof_uid` column
          in use_of_force.csv.
      - name: agency
        description: >
          the police department that the officer and/or complaint/use of force report
          referred to belong to.
      - name: badge_no
        description: >
          officer's badge number
      - name: employee_id
        description: >
          referred officer's internal employee number.
      - name: department_code
        description: >
          internal code of the department the officer belong to at the time of the event.
          Due to how widely unavailable this field is, it is not very useful.
      - name: department_desc
        description: >
          text description of the department the officer belong to at the time of the
          event.
      - name: division_desc
      - name: sub_division_a_desc
      - name: sub_division_b_desc
      - name: current_supervisor
      - name: employee_class
        description: >
          classification of job titles
      - name: rank_code
        description: >
          internal rank code of the officer at the time of the event. Due to how widely
          unavailable this field is, it is not very useful.
      - name: rank_desc
        description: >
          text description of the officer's rank at the time of the event.
      - name: officer_employment_status
      #   description: >
      #     whether the officer is full time, part time, reserve, ... etc
      - name: sworn
        description: >
          whether the officer is sworn or not
      - name: officer_inactive
        description: >
          whether the officer is still active
      - name: employee_type
        description: >
          whether the officer is commissioned or not.
      - name: years_employed
        integer: true
      - name: salary
        float: true
      - name: salary_freq
        options:
          - hourly
          - daily
          - weekly
          - bi-weekly
          - monthly
          - yearly
      - name: award
        description: >
          award given to the officer
      - name: award_comments
        description: >
          further description of the award
      - name: left_reason
      - name: officer_contract_status
      - name: time_active
    validation_tasks:
      - name: event dates should be valid
        valid_date:
          date_from:
            year_column: year
            month_column: month
            day_column: day
          min_date: "1900-01-01"
      - name: no officer with more than 1 left date in a calendar month
        where:
          column: kind
          op: equal
          value: officer_left
        group_by: uid
        no_more_than_once_per_30_days:
          date_from:
            year_column: year
            month_column: month
            day_column: day
  use_of_force:
    columns:
      - name: uof_uid
        description: >
          unique identifier of use of force report.
        unique: true
        no_na: true
      - name: uof_tracking_number
        description: >
          tracking number of use of force report from the originating agency.
      - name: report_year
        description: >
          year of report
      - name: uid
        description: >
          officer unique identifier, this references the `uid` column from personnel.csv
      - name: force_description
        description: >
          summary of force used
      - name: force_type
      - name: force_level
      - name: effective_uof
      - name: accidental_discharge
      - name: less_than_lethal
      - name: status
      - name: source
      - name: service_type
      - name: county
      - name: traffic_stop
      - name: sustained
      - name: force_reason
      - name: weather_description
      - name: distance_from_officer
      - name: body_worn_camera_available
      - name: app_used
      - name: citizen_uid
        description: >
          unique identifier for each citizen involved in a report.
      - name: citizen_arrested
      - name: citizen_hospitalized
      - name: citizen_injured
      - name: citizen_body_type
      - name: citizen_height
      - name: citizen_age
        integer: true
      - name: citizen_involvement
      - name: disposition
      - name: citizen_sex
        options:
          - female
          - male
      - name: citizen_race
        options:
          - black
          - white
          - hispanic
          - native american
          - asian / pacific islander
          - mixed
      - name: citizen_age_1
        integer: true
      - name: officer_current_supervisor
      - name: officer_title
      - name: officer_injured
      - name: officer_age
        integer: true
      - name: officer_years_exp
        integer: true
      - name: officer_years_with_unit
        integer: true
      - name: officer_type
      - name: officer_employment_status
      - name: officer_department
      - name: officer_division
      - name: officer_sub_division_a
      - name: officer_sub_division_b
      # - name: data_production_year
      #   description: >
      #     the year of the original data. Usually it is the year number appear
      #     in the original data file. Perhaps we don't need this column anymore (now
      #     that there is the event tables).
      #   integer: true
      #   range: [1900, 2021]
      - name: agency
        description: >
          the police department this report originate from.

save_bad_rows_to: invalid_rows.csv
